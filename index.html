<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>memo2</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
    .tabs { display: flex; background: #333; color: white; }
    .tab { padding: 10px 20px; cursor: pointer; }
    .tab.active { background: #555; }
    .content { display: none; padding: 20px; }
    .content.active { display: block; }
    textarea, input[type="text"] { width: 100%; padding: 10px; margin-top: 10px; }
    button { margin-top: 10px; padding: 10px 20px; }
    .btn-group button { margin-right: 10px; }
    .sub-tabs { display: flex; margin-top: 20px; }
    .sub-tab { margin-right: 10px; cursor: pointer; color: blue; text-decoration: underline; }
    .sub-tab.active { font-weight: bold; }
    .score-low { color: red; }
    .score-high { color: green; }
  </style>
</head>
<body>
  <script>
    const password = prompt("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š");
    if (password !== "2410") {
      document.body.innerHTML = '<h2>ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚</h2>';
      throw new Error("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸æ­£");
    }
  </script>
  <div class="tabs">
    <div class="tab active" onclick="switchTab(0)">æ¼”ç¿’ï¼ˆAï¼‰</div>
    <div class="tab" onclick="switchTab(1)">å…¥åŠ›ï¼ˆBï¼‰</div>
    <div class="tab" onclick="switchTab(2)">ç¢ºèªï¼ˆCï¼‰</div>
  </div>

  <div id="tabA" class="content active">
    <button onclick="startExercise()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <div id="exerciseQuestion"></div>
    <input type="text" id="exerciseAnswer" placeholder="è§£ç­”ã‚’å…¥åŠ›" onkeypress="checkEnter(event)">
    <div id="correctAnswer" style="margin-top:10px;"></div>
    <div class="btn-group">
      <button onclick="gradeAnswer('maru')">ã€‡</button>
      <button onclick="gradeAnswer('sankaku')">â–³</button>
      <button onclick="gradeAnswer('batsu')">Ã—</button>
    </div>
  </div>

  <div id="tabB" class="content">
    <textarea id="newQuestion" placeholder="å•é¡Œã‚’å…¥åŠ›"></textarea>
    <button onclick="startSpeech('newQuestion')">ğŸ¤ éŸ³å£°å…¥åŠ›ï¼ˆå•é¡Œï¼‰</button>
    <textarea id="newAnswer" placeholder="è§£ç­”ã‚’å…¥åŠ›"></textarea>
    <button onclick="startSpeech('newAnswer')">ğŸ¤ éŸ³å£°å…¥åŠ›ï¼ˆè§£ç­”ï¼‰</button>
    <button onclick="saveQuestion()">ä¿å­˜</button>
  </div>

  <div id="tabC" class="content">
    <div class="sub-tabs">
      <div class="sub-tab active" onclick="switchSubTab(0)">ç¢ºèª</div>
      <div class="sub-tab" onclick="switchSubTab(1)">ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ</div>
      <div class="sub-tab" onclick="switchSubTab(2)">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</div>
    </div>
    <div id="subTab0" class="sub-content">
      <h3>ä¿å­˜ã•ã‚ŒãŸå•é¡Œä¸€è¦§</h3>
      <ul id="questionList"></ul>
    </div>
    <div id="subTab1" class="sub-content" style="display:none;">
      <button onclick="downloadQuestions()">ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›</button>
    </div>
    <div id="subTab2" class="sub-content" style="display:none;">
      <input type="file" id="fileInput">
      <button onclick="uploadQuestions()">èª­ã¿è¾¼ã¿</button>
    </div>
  </div>

  <script>
    let questions = JSON.parse(localStorage.getItem('questions') || '[]');
    let currentQueue = [];
    let currentIndex = 0;

    function switchTab(index) {
      document.querySelectorAll('.tab').forEach((tab, i) => tab.classList.toggle('active', i === index));
      document.querySelectorAll('.content').forEach((content, i) => content.classList.toggle('active', i === index));
      if (index === 2) renderList();
    }

    function switchSubTab(index) {
      document.querySelectorAll('.sub-tab').forEach((tab, i) => tab.classList.toggle('active', i === index));
      document.querySelectorAll('.sub-content').forEach((content, i) => content.style.display = i === index ? 'block' : 'none');
    }

    function saveQuestion() {
      const q = document.getElementById('newQuestion').value.trim();
      const a = document.getElementById('newAnswer').value.trim();
      if (q && a) {
        questions.push({ question: q, answer: a, score: 0, origin: true });
        localStorage.setItem('questions', JSON.stringify(questions));
        document.getElementById('newQuestion').value = '';
        document.getElementById('newAnswer').value = '';
      }
    }

    function renderList() {
      const list = document.getElementById('questionList');
      list.innerHTML = '';
      questions.forEach((qa, i) => {
        if (!qa.origin) return;
        const scoreClass = qa.score <= -3 ? 'score-low' : (qa.score >= 3 ? 'score-high' : '');
        const li = document.createElement('li');
        li.innerHTML = `<span class="${scoreClass}">Q${i + 1}</span>: <input value="${qa.question}" onchange="editQuestion(${i}, 'question', this.value)"> ï¼ A: <input value="${qa.answer}" onchange="editQuestion(${i}, 'answer', this.value)"> ï¼ ã‚¹ã‚³ã‚¢: ${qa.score ?? 0}`;
        list.appendChild(li);
      });
    }

    function editQuestion(index, field, value) {
      questions[index][field] = value;
      localStorage.setItem('questions', JSON.stringify(questions));
    }

    function startExercise() {
      if (questions.length === 0) return alert('å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“');
      const original = questions.filter(q => q.origin);
      currentQueue = original
        .map((q, i) => ({ ...q, index: i, weight: 1 / (Math.abs(q.score ?? 0) + 1) }))
        .sort(() => Math.random() - 0.5)
        .sort((a, b) => b.weight - a.weight);
      currentIndex = 0;
      nextQuestion();
    }

    function nextQuestion() {
      if (currentIndex >= currentQueue.length) {
        alert('å…¨å•çµ‚äº†');
        return;
      }
      const q = currentQueue[currentIndex];
      document.getElementById('exerciseQuestion').textContent = `Q${q.index + 1}: ${q.question}`;
      document.getElementById('exerciseAnswer').value = '';
      document.getElementById('correctAnswer').textContent = '';
    }

    function checkEnter(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        document.getElementById('correctAnswer').textContent = 'æ­£è§£: ' + currentQueue[currentIndex].answer;
      }
    }

    function gradeAnswer(grade) {
      const q = currentQueue[currentIndex];
      if (questions[q.index]) {
        if (!('score' in questions[q.index])) questions[q.index].score = 0;
        if (grade === 'maru') questions[q.index].score += 1;
        else if (grade === 'sankaku') questions[q.index].score -= 0.5;
        else if (grade === 'batsu') questions[q.index].score -= 1;
      }
      localStorage.setItem('questions', JSON.stringify(questions));
      currentIndex++;
      nextQuestion();
    }
  </script>
</body>
</html>
